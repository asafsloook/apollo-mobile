function generateHash(){let o="0x";for(var e=0;e<64;e++)o+=Math.floor(16*Math.random()).toString(16);return o}class Random{constructor(){window.params||(window.params={seed:generateHash()}),this.useA=!1;function o(o){let e=parseInt(o.substr(0,8),16),r=parseInt(o.substr(8,8),16),n=parseInt(o.substr(16,8),16),t=parseInt(o.substr(24,8),16);return function(){e|=0,r|=0,n|=0,t|=0;var o=(e+r|0)+t|0;return t=t+1|0,e=r^r>>>9,r=n+(n<<3)|0,n=(n=n<<21|n>>>11)+o|0,(o>>>0)/4294967296}}this.prngA=new o(window.params.seed.substr(2,32)),this.prngB=new o(window.params.seed.substr(34,32));for(let o=0;o<1e6;o+=2)this.prngA(),this.prngB()}random_dec(){return this.useA=!this.useA,this.useA?this.prngA():this.prngB()}random_num(o,e){return o+(e-o)*this.random_dec()}random_int(o,e){return Math.floor(this.random_num(o,e+1))}random_bool(o){return this.random_dec()<o}random_choice(o){return o[this.random_int(0,o.length-1)]}}let DEFAULT_SIZE=1e3,R=new Random,DIM,M,colors={},grid=0,options={},shapes=[],intersections={},lines={vert:{},horiz:{},diagonal:[]},bg="#e0dacc",min_stroke=1,max_stroke=2.5,helper={},state={color:0,grain:0},density=2;const paletteNames={1:"Zeus",2:"Nemesis",3:"Aphrodite",4:"Apollo",5:"Ares",6:"Hephaestus",7:"Nike",8:"Artemis",9:"Athena",10:"Hecate",11:"Hermes",12:"Dionysus",13:"Hades",14:"Hypnos",15:"Demeter",16:"Janus",17:"Hera",18:"Poseidon",19:"Tyche",20:"Iris"};function getPalette(){return{1:["#D04B38","#4D89AB","#F4DDB2","#1B3146"],2:["#E16601","#83754E","#20211C","#E8C988"],3:["#393230","#F7F0DB","#F8C9B2","#AA2B34","#E99A51"],4:["#F6DB77","#FBB355","#DC252A","#2C221E"],5:["#CC3622","#DDB779","#590F02","#9A9855"],6:["#F6EAC0","#0D1218","#4F565C","#AE8F61"],7:["#145F6C","#AB342C","#1F272A","#E3CBA4"],8:["#C78934","#CAAC1C","#143728","#2F613B","#0F2A1A"],9:["#F6F1D3","#254144","#BED8C9","#229A8D"],10:["#C47B59","#9D3D28","#E8C789","#53373A","#30313E","#396934"],11:["#786865","#544650","#53373A","#E5B24E","#9D3D28"],12:["#CBC8B8","#8F9D82","#544650","#786865","#F5EAC2"],13:["#44A47E","#E0C87C","#DC640E","#043434"],14:["#006F6D","#E5E1C6","#EA5339","#340100"],15:["#362a17","#405D3A","#297545","#A1A66A","#E3C37C"],16:["#D1CCB5","#5B231F","#CF5F5B","#2D5542","#668067"],17:["#CCBD8F","#AA6425","#264224","#495423","#70A494"],18:["#098F75","#9DBBCD","#82AFBB","#142755"],19:["#C47B59","#E8C789","#E4CFB7","#E5B24E","#F5EAC2"],20:["#AB342C","#145F6C","#e5ac3c","#20211C"]}[options.palette]}function getOptions(){return{position_type:null,maxOrph:R.random_bool(.9)?R.random_int(1,R.random_choice([10,15,20])):1,shapes_border:!0,stroke:.5,is_diagonal:R.random_bool(.5),orph_side:R.random_choice(["h","v"]),color_count:R.random_choice([0,5,50]),texture_dir:R.random_choice(["x","y"]),texture_dir_reverse:R.random_bool(.5),texture_dir_reverse_static:R.random_bool(.5),texture_prob:R.random_choice([.5,.75]),texture_max:R.random_choice([.75,1]),colors_grain:R.random_choice([.05]),patterns:R.random_int(1,3),draw_borders_change:R.random_choice([.01,.1]),isDouble:R.random_bool(.5),isDoubleType:R.random_bool(.5),doubleMax:R.random_choice([3,6,10]),isMainDouble:R.random_bool(.1),isSecDouble:R.random_bool(.25),empty:R.random_bool(.5),empty_prob:R.random_choice([.4,.5]),ratio:1.5,frame_border:R.random_choice([.05]),changePosition:R.random_bool(.5),changePosition2:R.random_bool(.5),changeSecPosition:R.random_bool(.5),changeCirclePosition:R.random_bool(.25),maxChangePositionCircle:R.random_choice([.25,.5]),maxChangePositionSec:R.random_choice([.5,.75,1]),palette:R.random_int(1,20),bgType:R.random_bool(.06),less:R.random_bool(.25),out_frame:R.random_bool(.1),white:R.random_bool(.25)}}function genOptions(){for(var o={},e=getOptions(),r=Object.keys(e);Object.keys(o).length<r.length;){var n=R.random_choice(r);n in Object.keys(o)||(o[n]=getOptions()[n])}return o}function cfl(o){return o[0].toUpperCase()+o.substring(1)}function setMetadataAndComplete(){var o=options.position_type;o.includes("_")&&(options.position_type=o.substring(0,o.indexOf("_"))),window.metadata={Palette:paletteNames[options.palette],Composition:cfl(options.position_type),Background:options.bgType?"Random":"Paper","Circles Escape":cfl(options.out_frame.toString()),"Light Colors":cfl(options.white.toString()),"Aspect Ratio":cfl(options.ratio.toString()),"Out of Ink":cfl(options.empty.toString()),"Double Borders":cfl(options.isDouble.toString())},document.complete=!0}function genPositionType(){let o=R.random_dec(),e;switch(!0){case o<.05:e="robert";break;case o<.1:e=R.random_choice(["sonia","sonia_orph"]);break;case o<.15:options.out_frame=!1,e="portal";break;case o<.25:e="dmitri_"+R.random_choice(["b","c"]);break;case o<.35:e="space";break;case o<.45:e="oracle";break;case o<.65:e="piton";break;default:e="delphi"}return e}function setProps(){(options=genOptions()).position_type=genPositionType(),colors.fill=getPalette();let e=options.color_count;for(let o=0;o<e;o++){var r=color(R.random_choice(colors.fill)),n=color(R.random_choice(["#fff","#000"]));colors.fill.push(lerpColor(r,n,R.random_num(.01,.1)))}if(options.white){const e=colors.fill.length*R.random_num(0,.5);for(let o=0;o<e;o++)colors.fill.push("#fff")}}function setup(){var o=R.random_num(1,999999999);noiseSeed(o),randomSeed(o),setProps(),pixelAndDim(),createCanvas(DIM,getHeight_())}function getHeight_(){return(1-options.frame_border)*DIM*options.ratio+DIM*options.frame_border}function createPatterns(){var e=[];for(let o=0;o<options.patterns;o++)e.push(createLinesPattern()),e.push(createGradientPattern());return e}function getTwoColors(){for(;;){var o=R.random_choice(colors.fill),e=R.random_choice(colors.fill);if(o!==e)return[o,e]}}function createGradientPattern(){var e=DEFAULT_SIZE*options.ratio,r=createGraphics(e,e),o=(r.pixelDensity(density),getTwoColors()),n=color(o[0]),t=color(o[1]);r.strokeWeight(2);for(let o=0;o<e;o++){var a=map(o,0,e,0,1),a=lerpColor(n,t,a);r.stroke(a),r.line(0,o,e,o)}return r}function createLinesPattern(){var r=DEFAULT_SIZE*options.ratio,n=createGraphics(r,r),o=(n.pixelDensity(density),getTwoColors()),e=(n.background(o[0]),R.random_choice(["v","h","d1","d2"])),t=(n.fill(o[1]),n.noStroke(),R.random_choice([10,10,15])),a=+M;if("v"===e)for(let o=2;o<r;o+=t)drawLine(a,o,0,o,r,n);if("h"===e)for(let o=2;o<r;o+=t)drawLine(a,0,o,r,o,n);if("d1"===e)for(let o=2,e=2;o<2*r;)drawLine(a,0,e,o,0,n),o+=2*t,e+=2*t;if("d2"===e)for(let o=r-2,e=2;o>-r;)drawLine(a,r,e,o,0,n),o-=2*t,e+=2*t;return n}function setCanvasBG(){background(options.bgType?(()=>{for(;;){var o=R.random_choice(colors.fill);if("#fff"!==o)return o}})():bg)}function draw(){colors.pattern=createPatterns(),setCanvasBG(),start_(),noLoop()}function pixelAndDim(){pixelDensity(density),(DIM=Math.round(window.innerWidth))%2!=0&&DIM++,M=DIM/DEFAULT_SIZE}function getCirclePos(o,e){var r=getShapeSize();return{...getShapePos(o,e),type:"circle",r:.4*r}}function getShapePos(o,e){var r=getShapeSize(),n=R.random_num(-1,1),t=R.random_num(-1,1),a=DEFAULT_SIZE*options.frame_border;return{x:a+e*r+r/2+n,y:a+o*r+r/2+t}}function getShapeSize(){return DEFAULT_SIZE*(1-2*options.frame_border)/options.grid}function getTrianglePos(o,e,r=1){var r=r*getShapeSize()/2,o=getShapePos(o,e),e=R.random_num(0,2*PI),n=(o,e,r,n)=>({x:r*cos(n)+o,y:r*sin(n)+e});return{p1:n(o.x,o.y,r,0+e),p2:n(o.x,o.y,r,1/3*TWO_PI+e),p3:n(o.x,o.y,r,2/3*TWO_PI+e),x:o.x,y:o.y,r:r,type:"triangle"}}function drawSecShapes(){var o=R.random_int(1,4);1===o&&squareBG(),2===o&&fullRects(),3===o&&fullTrios(),4===o&&linesBG(R.random_bool(.5))}function squareBG(o=0,e=0,r=1){options.grid=r,setOneShape(o,e,"square",.5);var r=getLastShape(),o=(r.square_bg=!0,options.ratio),e=2*options.frame_border,n=DEFAULT_SIZE*e,e=DEFAULT_SIZE*(1-e);r.w=e-n,r.h=e*o-n/o,r.y=n,r.x=n}function randomTri(){let o=.1*-DEFAULT_SIZE,e=1.1*DEFAULT_SIZE,r=()=>R.random_num(0,DEFAULT_SIZE);var n=()=>R.random_choice([{x:o,y:r()},{x:e,y:r()},{y:o,x:r()},{y:e,x:r()}]);return{...createShape("triangle"),p1:n(),p2:n(),p3:n()}}function fullTrios(){var e,r;for(let o=0;o<R.random_int(5,10);o++){var n=randomTri();e=n,r=void 0,r=.5*DEFAULT_SIZE,dist(e.p1.x,e.p1.y,e.p2.x,e.p2.y)>r&&dist(e.p1.x,e.p1.y,e.p3.x,e.p3.y)>r&&dist(e.p2.x,e.p2.y,e.p3.x,e.p3.y)>r&&shapes.push(n)}}function randomColor(o){var e=R.random_choice(colors.fill);R.random_choice(colors.pattern);return o||R.random_bool(options.texture_prob)?!o&&R.random_bool(options.empty?options.empty_prob:0)?"BLANK":R.random_choice([e,e]):bg}function drawMainShapes(){if(["portal"].includes(options.position_type)){options.grid=1;var e=R.random_int(25,50);for(let o=1;o<e;o++)setOneShape(0,0,"circle",2*o*R.random_int(.9,1.1)/e),getLastShape().total=e}if(["delphi"].includes(options.position_type)){let e=0;var r={},n=(state.orph=!1,R.random_int(1,4));for(let o=0;o<n&&!(1e4<e++);o++){options.grid=R.random_int(2,4);var t=randomCell(),a=randomCell(),i=options.grid*R.random_num(1,2);r[t+`_${a}_`+options.grid]?o--:(!state.orph&&R.random_bool(.75)?(orphCircle(t,a,i,getOrphNumber()),orph=!0):setOneShape(t,a,"circle",i),r[t+`_${a}_`+options.grid]=!0)}}if(["space"].includes(options.position_type)&&spreadCircles(),["sonia","sonia_orph"].includes(options.position_type)){var o=R.random_dec();let n=o<=.9?.5:o<=.1?1:0,e=0;options.is_diagonal;for(let o=0;o<10&&!(1e6<e++);o++){var s=R.random_num(.05*DEFAULT_SIZE,.2*DEFAULT_SIZE);let e=.5*DEFAULT_SIZE,r=0;var p=getLastShape(),c=(p&&"circle"===p.type&&(e=p.x,r=p.y+(p.r+s/R.random_num(1.5,2.5))),getOrphNumber());for(let o=1;o<=c;o++){if(R.random_bool(n)&&1===o){var l={...createShape("circle"),x:e,y:r,r:s,total:c};shapes.push(l);break}l={...createShape("circle"),x:e,y:r,r:o*(s/c),total:c};shapes.push(l)}}}if(["robert","center"].includes(options.position_type)&&(options.grid=1,orphCircle(0,0,R.random_num(.5,2),getOrphNumber())),["dmitri_b","dmitri_c"].includes(options.position_type)){var d=[],o=[[2,4,8],[3,6,12]],_=(R.random_bool(.1)&&o.push([5,10,20]),R.random_choice(o)),o=R.random_dec();let r=o<=.5?.5:o<=.1?1:0;var o=_[2]*_[2],h=R.random_int(.05*o,o*R.random_choice([1,2,10]));for(let o=0;o<h;o++){options.grid=R.random_choice(_);var m=randomCell(),u=randomCell();if(![4,6,8,12].includes(options.grid)||0!==m&&0!==u&&m!==options.grid-1&&u!==options.grid-1){let e=!0;var f=getCirclePos(m,u),g=.4*getShapeSize();for(let o=0;o<d.length;o++){var y=d[o];collision(y.x,y.y,y.r,f.x,f.y,g)&&(e=!1)}e&&(orphCircle(m,u,1,R.random_bool(r)?1:getOrphNumber()),d.push(getLastShape()))}}options.changePosition2=!1}if("piton"===options.position_type){var S=R.random_bool(.5),x=R.random_bool(.5),E=()=>({x:R.random_num(0,DEFAULT_SIZE),y:R.random_num(0,DEFAULT_SIZE)});let e=R.random_int(1,R.random_choice([5,10,15,20]));x&&(e=R.random_int(2,R.random_choice([5,10,20,50]))),S&&(e*=2);for(let o=0;o<e;o++){var b=E(),v=R.random_num(1,3),D=E(),b=dist(b.x,b.y,D.x,D.y);let e=(DEFAULT_SIZE-b)/v,r=(S&&R.random_bool(.2)&&(e=R.random_num(10,50)),!0);var A=shapes.filter(o=>"circle"===o.type);if(x)for(let o=0;o<A.length;o++){var I=A[o];collision(I.x,I.y,I.r,D.x,D.y,e)&&(r=!1)}r&&shapes.push({...createShape("circle"),x:D.x,y:D.y,r:e/2,total:1})}}"oracle"===options.position_type&&(o=()=>.5*DEFAULT_SIZE+R.random_num(.2*-DEFAULT_SIZE,.2*DEFAULT_SIZE),shapes.push({...createShape("circle"),x:o(),y:o(),r:R.random_choice([R.random_num(.05*DEFAULT_SIZE,.2*DEFAULT_SIZE),R.random_num(.1*DEFAULT_SIZE,.1*DEFAULT_SIZE)])}),options.changePosition=!1,options.changePosition2=!1,options.isMainDouble=!1,options.isSecDouble=!1,options.empty=!1,options.less=R.random_bool(.5))}function checkLineIntersect(e,r){for(let o=-10;o<=10;o++)if(e[(r+o).toFixed()])return!0;return!1}function drawOrphLines(o,t,a,i,e){var s=10*DEFAULT_SIZE;if(e){let e=(o,e,r,n)=>{var t=(o,e)=>(e.x-o.y)/(e.x-o.x),a=(o,e)=>(e.x*o.y-o.x*e.y)/(e.x-o.x),i=t(o,e),o=a(o,e),e=t(r,n),t=a(r,n);return Math.abs(i-e)+Math.abs(o-t)<25},r={...createShape("triangle"),p1:{x:o-s,y:t-s},p2:{x:o+s,y:t+s},p3:{x:o+s,y:t-s}},n=(a&&!lines.diagonal.some(o=>"vert"===o.type&&e(o.shape.p1,o.shape.p2,r.p1,r.p2))&&(shapes.push(r),lines.diagonal.push({type:"vert",shape:getLastShape()})),{...createShape("triangle"),p1:{x:o-s,y:t+s},p2:{x:o+s,y:t-s},p3:{x:o+s,y:t+s}});i&&!lines.diagonal.some(o=>"horiz"===o.type&&e(o.shape.p1,o.shape.p2,n.p1,n.p2))&&(shapes.push(n),lines.diagonal.push({type:"horiz",shape:getLastShape()}))}else a&&!checkLineIntersect(lines.vert,o)&&(lines.vert[o.toFixed()]=!0,shapes.push({...createShape("square"),x:o,y:t-s/2,w:s,h:s})),i&&!checkLineIntersect(lines.horiz,t)&&(lines.horiz[t.toFixed()]=!0,shapes.push({...createShape("square"),x:o-s/2,y:t,w:s,h:s}))}function setFrameShapes(){drawMainShapes(),["sonia_orph","dmitri_c","robert"].includes(options.position_type)?setOrphLines():(drawSecShapes(),options.isSecDouble&&drawSecShapes())}function getOrphNumber(){return R.random_int(1,options.maxOrph)}function orphCircle(e,r,n=1,t,a){for(let o=1;o<=t;o++){setOneShape(e,r,"circle",o*(n/t));var i=getLastShape();a&&(i.x+=a.sx,i.y+=a.sy),i.total=t}}function collision(o,e,r,n,t,a,i=10){o-=n,n=e-t;return r+a+i>Math.sqrt(o*o+n*n)}function createShape(o){return{type:o,color:randomColor(),id:genId()}}function spreadCircles(){var r=R.random_choice([0,.5,1]),n=R.random_choice([250,500,1e3]),t=R.random_choice([25,100]);for(let o=0;o<n;o++){var a=R.random_num(t,350-map(o,0,n,0,350-t)),i=R.random_num(0,DEFAULT_SIZE),s=R.random_num(0,DEFAULT_SIZE);let e=!0;for(let o=0;o<shapes.length;o++){var p=shapes[o];"circle"===p.type&&collision(p.x,p.y,p.r,i,s,a,2*a)&&(e=!1)}if(e){var c=getOrphNumber();for(let o=1;o<=c;o++){if(R.random_bool(r)&&1===o){var l={...createShape("circle"),x:i,y:s,r:a,total:c};shapes.push(l);break}l={...createShape("circle"),x:i,y:s,r:o*(a/c),total:c};shapes.push(l)}}}}function linesBG(r){let o=r?1:1.42857142857,n=r?1:2,t=R.random_int(10,25);var e=R.random_choice(["left","right"]);let a=()=>R.random_int(2,R.random_choice([5,10])*o);var i=()=>(()=>{const e=r?"square":"triangle";return shapes.filter(o=>o.type===e).length>t*n})()?R.random_choice([.01,.05]):R.random_choice([.1,.25,.5]);let s=()=>R.random_int(R.random_choice([10,50]),R.random_choice([250,500]))*o;var p;let c=i(),l=s(),d=-DEFAULT_SIZE,_=2*DEFAULT_SIZE;r&&("right"===e&&(options.texture_dir="x"),"left"===e&&(options.texture_dir="y"),d=-R.random_num(10,20),_=DEFAULT_SIZE);for(let o=d;o<_;)r||(p=DEFAULT_SIZE,"left"===e&&(shapes.push({p1:{x:DEFAULT_SIZE+p,y:o},p2:{x:DEFAULT_SIZE+p,y:DEFAULT_SIZE+p},p3:{x:o,y:DEFAULT_SIZE+p},...createShape("triangle")}),moveBit(null,.5,2),shapes.push({p1:{x:DEFAULT_SIZE+p,y:o+l},p2:{x:DEFAULT_SIZE+p,y:DEFAULT_SIZE+p},p3:{x:o+l,y:DEFAULT_SIZE+p},...createShape("triangle")}),moveBit(null,.5,2)),"right"===e&&(shapes.push({p1:{x:-p,y:-o},p2:{x:DEFAULT_SIZE+o,y:DEFAULT_SIZE+p},p3:{x:-p,y:DEFAULT_SIZE+p},...createShape("triangle")}),moveBit(null,.5,2),shapes.push({p1:{x:-p,y:-o-l},p2:{x:DEFAULT_SIZE+o+l,y:DEFAULT_SIZE+p},p3:{x:-p,y:DEFAULT_SIZE+p},...createShape("triangle")}),moveBit(null,.5,2))),r&&("left"===e&&(shapes.push({x:o,y:-10,w:l,h:DEFAULT_SIZE+20,...createShape("square")}),moveBit(null,.5,2)),"right"===e)&&(shapes.push({x:-10,y:o,w:DEFAULT_SIZE+20,h:l,...createShape("square")}),moveBit(null,.5,2)),o+=l+R.random_choice([a(),s()/2]),l=s(),R.random_bool(.5)&&(c=i()),R.random_bool(c)&&(l=a())}function fullRects(){var e=R.random_bool(.5),r=R.random_bool(.5),n=R.random_bool(.5);options.texture_dir=e?"x":"y",options.grid=R.random_int(R.random_choice([2,3]),6);let t=0,a=1;var i=R.random_num(.5,1);for(let o=0;o<options.grid;o++)R.random_bool(r)&&0<t||(setOneShape(e?o:0,e?0:o,"rectangle",null,e),n&&(getLastShape()[e?"h":"w"]*=a),a*=i,t++)}function getLastShape(){return shapes[shapes.length-1]}function randomCell(){return R.random_int(1,options.grid)-1}function genId(){return R.random_int(1,999999999)}function setOneShape(o,e,r,n,t){var a=r,i=genId();switch(a){case"circle":var s={...getCirclePos(o,e),type:a,id:i,total:1};s.r*=n||1,circleExist(s)||shapes.push(s);break;case"triangle":s={...getTrianglePos(o,e,n),type:a,id:i};shapes.push(s);break;case"square":case"rectangle":var s=getShapeSize()*(n||.8),p=DEFAULT_SIZE*(1-2*options.frame_border)-.25*s*options.ratio,c="rectangle"===a&&t?p:s,p="rectangle"!==a||t?s:p,c={...getShapePos(o,e),w:c,h:p,type:a,id:i};"square"===a&&(c.x-=c.w/2,c.y-=c.h/2),"rectangle"===a&&(t?(c.y-=c.h/2,c.x-=s/2):(c.x-=c.w/2,c.y-=s/2)),shapes.push(c)}noStroke()}function roundBy(o,e){return Math.round(o/e)*e}function circleExist(r){for(let o=0;o<shapes.length;o++){var n=shapes[o];if("circle"===n.type){var t=["x","y","r"];let e=0;for(let o=0;o<3;o++){var a=t[o];roundBy(n[a],5)===roundBy(r[a],5)&&e++}if(3===e)return!0}}return!1}function moveBit(o,e,r){const n={...o||getLastShape()};let t=()=>R.random_num(e,r);var a,o=o=>{n[o]*=t()},i=(o,e)=>{n[e][o]*=t()};return"triangle"===n.type?(a="p"+R.random_int(1,3),R.random_bool(.3333)?i("x",a):(R.random_bool(.5)||i("x",a),i("y",a))):(R.random_bool(.5)&&(n.r*=t()),R.random_bool(.3333)?o("x"):(R.random_bool(.5)||o("x"),o("y")),R.random_bool(.3333)?o("w"):(R.random_bool(.5)||o("w"),o("h"))),n}function drawOneShape(o,e){var r=("triangle"===o.type?.025:0)+(o.r<50?.025:0),n={...moveBit(o,.95+r,1.05-r)},t=+M;switch(n.type){case"circle":drawCircle(n.x*M,n.y*M,t,n.r,null,e);break;case"triangle":drawLine(t,n.p1.x,n.p1.y,n.p2.x,n.p2.y,null,e),drawLine(t,n.p1.x,n.p1.y,n.p3.x,n.p3.y,null,e),drawLine(t,n.p2.x,n.p2.y,n.p3.x,n.p3.y,null,e);break;case"square":case"rectangle":drawLine(t,n.x,n.y,n.x+n.w,n.y,null,e),drawLine(t,n.x,n.y,n.x,n.y+n.h,null,e),drawLine(t,n.x+n.w,n.y+n.h,n.x+n.w,n.y,null,e),drawLine(t,n.x+n.w,n.y+n.h,n.x,n.y+n.h,null,e)}}function isFrame(o,e,r){var n,t;return(!options.out_frame||!r)&&(t=options.frame_border,r=r?M:1,n=DEFAULT_SIZE*t*r,t=DEFAULT_SIZE*(1-t)*r,r=options.ratio,o<n||t<o||e<n||t*r<e)}function drawLine(e,r,n,t,a,i,s){setRandomSketchColor();var p=dist(r,n,t,a);let c=R.random_bool(.5);var l,d,_=R.random_num(0,options.draw_borders_change);for(let o=0;o<=p;o++)(i||(c=R.random_bool(_)?!c:c))&&(l=lerp(r,t,o/p),d=lerp(n,a,o/p),s&&isFrame(l,d)||(i?i.arc(l,d,e/M,e/M,0,TWO_PI):arc(l*M,d*M,e,e,0,TWO_PI),e=manageRadius(e,l,d)))}function drawCircle(e,r,n,t,a,i,o){setRandomSketchColor();let s=0,p=map(t,0,DEFAULT_SIZE,50,5e3);a&&(p=20),t*=M;var c=TWO_PI/p;a?a.translate(e,r):translate(e,r);let l=!o&&R.random_bool(.5);var d=R.random_num(0,options.draw_borders_change);for(let o=0;o<p;o++){var _=t*sin(s),h=t*cos(s);s+=c,i&&isFrame(e+_,r+h,!0)||(l=R.random_bool(d)?!l:l)&&(a?a.arc(_,h,n,n,0,TWO_PI):arc(_,h,n,n,0,TWO_PI),n=manageRadius(n,_,h))}a?a.translate(-e,-r):translate(-e,-r)}function manageRadius(o,e,r){var n=.25*M;return R.random_bool(.45)&&o<max_stroke*M?o+=n:o>min_stroke*M&&(o-=n),o}async function shapesBorder(e){min_stroke=0,max_stroke=2,noStroke();var o=Object.keys(intersections).length,r=e?R.random_num(2,3):1,n=options.bgType?2:1,o=options.position_type.includes("dmitri")&&250<o&&5<options.maxOrph?5:1,t=Math.min(5*r/(n*o),20);for(let o=0;o<t;o++){await waiter(1);for(let o=0;o<shapes.length;o++)drawOneShape(shapes[o],e)}}function setRandomSketchColor(o){var e=R.random_int(100,205),r=R.random_num(.2,.4);fill(`rgba(${e},${e},${e},${o||r})`)}function setOrphLines(){options.is_diagonal||("h"===options.orph_side&&(options.texture_dir="x"),"v"===options.orph_side&&(options.texture_dir="y"));var e=shapes.filter(o=>"circle"===o.type),r=options.orph_side,n="hv"===r?10:25;if(e.length){var t=options.is_diagonal;for(let o=0;o<R.random_int(3,n);o++){var a=R.random_choice(e);drawOrphLines(a.x,a.y,["v","hv"].includes(r),["h","hv"].includes(r),t)}}}function setBG(){options.grid=1,setOneShape(0,0,"square",10);var o=getLastShape(),e=randomColor(!0);o.color=e,intersections[o.id]={color:e},o.bg=!0}function getDiffShape(){return R.random_num(2,options.doubleMax)}function doubleShapes(){var o=getDiffShape(),e=getDiffShape(),r=[];for(const a of shapes){var n=options.isDoubleType?o:getDiffShape(),t=options.isDoubleType?e:getDiffShape();r.push({...a,...createShape(a.type),x:a.x+n,y:a.y+t})}shapes.push(...r)}function randomSketching(){M;for(let o=0;o<R.random_int(500,1e3);o++)drawA();for(let o=0;o<R.random_int(2500,5e3);o++)drawB()}function drawB(){var o=+M,e=R.random_num(0,DEFAULT_SIZE),r=R.random_num(0,DEFAULT_SIZE);(R.random_bool(.5)?drawDirt:drawSin)(o,e,r)}function drawA(){var o=+M;const e=R.random_num(0,50);var r=o=>R.random_num(o-e,o+e),n=R.random_num(0,DEFAULT_SIZE),t=R.random_num(0,DEFAULT_SIZE);R.random_bool(.75)?drawLine(o,r(n),r(t),r(n),r(t)):drawCircle(n*M,t*M,+M,R.random_num(0,20),null,null,!0)}function drawSin(e,r,n){setRandomSketchColor(.05);var t=R.random_num(10,25),a=R.random_num(5,20),i=R.random_choice([-1,1]),s=R.random_choice([-1,1]);for(let o=0;o<=t;o++)r+=o*i,n+=sin(r)*a*s,arc(r*M,n*M,e,e,0,TWO_PI),e=manageRadius(e,r,n)}function drawDirt(e,r,n){setRandomSketchColor(.05);var t=R.random_num(10,25);for(let o=0;o<=t;o++)r+=R.random_num(-1,1),n+=R.random_num(-1,1),arc(r*M,n*M,e,e,0,TWO_PI),e=manageRadius(e,r,n)}function changePositions(){const e=DEFAULT_SIZE*options.maxChangePositionCircle/options.ratio,r=DEFAULT_SIZE*options.maxChangePositionSec/options.ratio;var o=o=>{o=o?e:r;return R.random_num(-o,o)};let n=o(R.random_bool(.5)),t=o(R.random_bool(.5));for(const p of shapes){var a="circle"===p.type,i=!a&&options.changeSecPosition,s=a&&options.changeCirclePosition;p.bg||(options.changePosition2&&(i||s)&&(n=o(a)/R.random_num(2,10),t=o(a)/R.random_num(2,10)),changePos(p,n,t))}}function changePos(o,e,r){o.x+=e,o.y+=r,"triangle"===o.type&&(o.p1.x+=e,o.p2.x+=e,o.p3.x+=e,o.p1.y+=r,o.p2.y+=r,o.p3.y+=r)}function fixRatioShapesPos(){for(const e of shapes){var o;e.square_bg||(o=(DEFAULT_SIZE*options.ratio-DEFAULT_SIZE)/2,e.y+=o,"triangle"===e.type&&(e.p1.y+=o,e.p2.y+=o,e.p3.y+=o))}}function setDouble(){options.isDouble&&!["portal","sonia","sonia_orph"].includes(options.position_type)&&doubleShapes()}function setAllShapes(){var o=R.random_bool(.5);setBG(),setFrameShapes(),options.isMainDouble&&!["dmitri_b","dmitri_c","sonia","sonia_orph","portal"].includes(options.position_type)?setFrameShapes():options.isMainDouble=!1,o&&setDouble(),options.changePosition&&changePositions(),fixRatioShapesPos(),o||setDouble()}function setLessShapes(){var o=shapes.length,e=Math.floor(R.random_num(0,.25*o));for(let o=0;o<e;o++){const r=R.random_choice(shapes);"circle"===r.type&&1===shapes.filter(o=>"circle"===o.type).length||r.bg||(shapes=shapes.filter(o=>o.id!==r.id))}}function circlesInScreen(){var o=shapes.filter(o=>"circle"===o.type);const r=DEFAULT_SIZE,n=DEFAULT_SIZE*options.ratio;return o.some(o=>{var e=0<o.x-o.r&&o.x+o.r<+r,o=0<o.y-o.r&&o.y+o.r<n;return e&&o})}function stopDraw(o,e,r,n){if(Array.isArray(o)&&!o.some(o=>"circle"===o.type)){o=DEFAULT_SIZE*n,n=DEFAULT_SIZE*(1-n);if(e<o||r<o||r>n*options.ratio||n<e)return!0}return!1}async function waiter(e){return new Promise(o=>{setTimeout(()=>{o()},e)})}async function start_(){var o;if(setAllShapes(),options.less&&setLessShapes(),circlesInScreen()){await shapesBorder(),randomSketching(),noStroke();var a=options.frame_border;let n=DEFAULT_SIZE*a,t=DEFAULT_SIZE*(1-a);var i=options.ratio,s=(options.out_frame&&(n=0,t=DEFAULT_SIZE),{draw_inc:.5,size:.99*M*(1<M?1.2:1)});for(let e=n;e<t*i;e+=s.draw_inc){R.random_bool(.5)&&await waiter(1);for(let o=n;o<t;o+=s.draw_inc){var{c:r,shape:p}=setColors(o,e);"BLANK"===r||R.random_bool(options.stroke)||r===bg||options.out_frame&&stopDraw(p,o,e,a)||"stop"!==p&&(isColor(r)?rect(o*M,e*M,s.size,s.size):image(r,o*M,e*M,s.size,s.size,o,e,s.size/M,s.size/M),state.color++)}}if(options.shapes_border){for(let r=n;r<t*i;r+=s.draw_inc){R.random_bool(.5)&&await waiter(1);for(let e=n;e<t;e+=s.draw_inc)if(!R.random_bool(options.stroke)){var{c,id:l,shape:d}=setColors(e,r);if(!(options.out_frame&&stopDraw(d,e,r,a)||"stop"===d||"BLANK"===c)){d=intersections[l];let o=map(r,d.yMin,d.yMax,d.min1,d.max1);"x"===options.texture_dir&&(o=map(e,d.xMin,d.xMax,d.min1,d.max1)),d.reverse&&(o=1-o);c=R.random_num(.9,1.1),d=color("#111");d.setAlpha(255*o*(intersections[l].color!==bg?options.colors_grain:1)*c),fill(d),rect(e*M,r*M,s.size,s.size),50<d.levels[3]&&state.grain++}}}console.log("color "+state.color),console.log("grain "+state.grain),shapesBorder(!0),randomSketching(),console.log(options),setMetadataAndComplete()}}else o=options.ratio,colors={},shapes=[],setProps(),options.ratio=o,colors.pattern=createPatterns(),setCanvasBG(),start_()}function saveIntersectionSizes(o,e,r){var n;intersections[r].max1?(o<(n=intersections[r]).xMin&&(n.xMin=o),o>n.xMax&&(n.xMax=o),e<n.yMin&&(n.yMin=e),e>n.yMax&&(n.yMax=e)):intersections[r]={color:intersections[r].color,xMin:1/0,xMax:0,yMin:1/0,yMax:0,bg:!1,min1:0,max1:R.random_num(options.texture_max,1),reverse:options.texture_dir_reverse_static?options.texture_dir_reverse:R.random_bool(.5)}}function isColor(o){return"string"==typeof o||"rgb"===o.mode}function sign(o,e,r){return(o.x-r.x)*(e.y-r.y)-(e.x-r.x)*(o.y-r.y)}function isPointInTriangle(o,e,r,n){var t=sign(o,e,r),r=sign(o,r,n),o=sign(o,n,e);return!((t<0||r<0||o<0)&&(0<t||0<r||0<o))}function isPointInCircle(o,e,r){return dist(o,e,r.x,r.y)<r.r}function isPointInSquare(o,e,r){return r.x<=o&&o<=r.x+r.w&&r.y<=e&&e<=r.y+r.h}function isShapeCollide(e,r){var n=[];for(let o=0;o<shapes.length;o++){var t=shapes[o];"circle"===t.type&&isPointInCircle(e,r,t)&&n.push(t),["square","rectangle"].includes(t.type)&&isPointInSquare(e,r,t)&&n.push(t),"triangle"===t.type&&isPointInTriangle({x:e,y:r},t.p1,t.p2,t.p3)&&n.push(t)}return 0<n.length?n:"stop"}function setColors(o,e){var r=isShapeCollide(o,e);if("stop"===r)return{shape:r};var n=saveIntersection(r);let t=intersections[n].color;return saveIntersectionSizes(o,e,n),isColor(t=t===bg&&intersections[n].bg?intersections[n].color:t)&&fill(t),{c:t,id:n,shape:r}}function saveIntersection(o){o=o.map(o=>o.id).sort((o,e)=>o-e).join("_");return intersections[o]||(intersections[o]={color:randomColor()}),o}